# 第一部分 基础知识

## 第一章 简介

### 1.1 并发简史

- 现实生活场景抽象
  - 寻求异步和同步的平衡点
- 关注点
  - 资源利用
  - 公平性
  - 便利性

### 1.2 线程优势

### 1.3 线程风险

### 1.4 线程无处不在

即使你的程序中从没有显式创建过线程，某些框架可能已经帮你做了这些事情，而且从这些线程调用的代码一定是线程安全的。这从另一个角度向我们展示了对于开发者设计和实现多线程的负担，因为开发线程安全的类比非线程安全的类需要更细心和理性的分析。

每一个Java应用都在使用线程。JVM启动时，会创建一系列线程用于处理JVM管理任务（垃圾清理、对象终结），并创建一个主线程用于运行main方法。AWT和Swing用户交互框架通过创建线程实现管理用户交互接口事件。Timer(定时器)通过创建线程执行延迟的任务。组件框架，比如servlets和RMI创建线程池并调用线程中的组件方法。

如果你使用这些功能（像其他开发人员一样），你必须熟悉并发和线程安全，因为这些框架创建线程并从线程中调用你的组件。如果并发只是一个可选且高级的语言特色就好了，但是现实是几乎所有的Java应用都是多线程的，而且这些框架不会将你从合理协调访问应用的状态中隔离出来。如果框架将并发引入应用中，一般很难控制框架的并发性，因为框架本质上会回调应用组件，这些组件会访问应用状态。同样的，对于线程安全的需要不仅仅局限于框架调用的组件，需要关注所有访问应用程序状态的组件代码路径。因此，对线程安全的需要是会扩散的。

```
框架通过在框架线程中调用应用组件将并发引入到应用中。组件总是会访问应用状态，因此需要访问应用状态的所有代码路径都是线程安全的
```

下面描述的这些功能将会导致应用代码从线程中被调用，而这并不受应用管理。对于线程安全的需求从这些功能开始，但并不从这些功能结束；相反，它会贯穿整个应用。

**定时器** 

定时器是一种方便的延迟任务的调度机制，可以运行一次或定期执行。定时器的引入会使序列化程序变得复杂，因为定制器任务运行在一个受定时器管理的线程中，而不受应用管理。如果定时任务需要访问其他应用线程也在访问的数据，那么它们都需要以线程安全的方式访问数据。最简单的方式是保证被定时任务访问的对象时线程安全的，因此，最简单的方法就是将线程安全封装在共享对象中。

**Servlets和JavaServer Pages(JSPs)**

Servlet设计的初衷是处理发布web应用所需基础设施问题，并分发来自HTTP客户端的请求。到达服务器被分发的请求，可能会通过一个过滤器链，然后到达合适的servlet和JSP。每个servlet表示一个应用程序逻辑组件，在大量访问的网站，多个客户端可能需要同时访问同一个servlet提供的服务。servlet规范要求其可以被多个线程同时访问。换句话说，servlet需要是线程安全的。

即使你可以保证一次只有一个线程调用该servlet，你仍需要在构建web应用的时候关注线程安全。Servlets经常访问其他servlets共享的状态信息，比如应用作用域对象（存储在ServletContext）或者session作用域对象（存储在ServletContext）。当一个servlet访问共享对象（通过servlets或request访问）时，必须协调合理的访问这些共享对象，因为多个请求可能会被多个线程同时访问。Servlets、JSP以及Servlet过滤器和存储在作用域容器（如ServletContext和HttpSession）中的对象，简单来说，必须保证线程安全。










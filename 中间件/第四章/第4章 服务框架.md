
----------
12/23/2016 10:13:04 AM 

----------
# 服务框架 #

1. 网站功能持续丰富后的困境与应对
	- 应用拆分
	- 服务化
		- 应用与底层的数据库、缓存系统、文件系统等系统之间增加服务层
		- 提高代码质量
		- 提高稳定性
		- 底层资源由服务层统一管理，结构更清晰，也更利于提高效率
2. 服务框架的设计与实现
	- 应用从集中式走向分布式所遇到的问题
		-   服务调用端的设计与实现
			- 调用发起->寻址路由->协议适配/序列化->网络传输->反序列化/协议解析->得到结果返回给调用方
				- 远程服务调用时，放置代理服务器
				- 直连
			- 代码
				- interfaceName
				- version
				- group
		- 运行期服务框架与应用和容器的关系
			- 服务框架自身的部署方式为问题
				- 把服务框架作为另一个应用的一个依赖包与应用一起打包，并随应用一起启动
					- 如果升级服务框架则应用也许更新
					- 服务框架无法做一些隔离以及包的实现替换工作
				- 把服务框架作为容器的一部分
					- 作为Tomcat、Jetty、JBoss等容器的一部分
					- 自身作为容器提供远程调用和远程服务的功能
			- 实现自己的服务框架所依赖的外部jar包与应用自身依赖的jar包冲突问题
			- ClassLoader
				- 需要把一些统一的jar包放到User-Defined ClassLoader的公用的“祖先”ClassLoader
				- Bootstrap ClassLoader
					- Extension ClassLoader
						- System ClassLoader
							- User-Defined ClassLoader
								- User Defined ClassLoader
							- User-Defined ClassLoader
		- 服务调用者与服务提供者之间通信方式的选择
			- 远程通信遇到的问题
				- 调用者与服务提供者通信问题
				- 调用者集群与服务提供者集群通信问题
			- 采用透明代理和调用者与服务者直连
				- 服务选择
					- 负载均衡
						- 随机
						- 轮询
						- 权重
							- 动态权重
								- 根据响应时间等参数计算
			- 引入基于接口、方法、参数的路由
				- 增加资源保证系统的能力是超出需要的
				- 隔离这些资源，使得快慢不同、重要级别不同的方法之间互不影响
			- 多机房场景
				- 物理机房-->转换为逻辑机房
				- 注册中心路由选择
			- 服务调用端的流控处理
				- 流量控制，保证系统稳定性
					- 根据服务端自身的接口、方法做控制
					- 根据来源做控制
			- 序列化与反序列化处理
				- 跨语言问题
				- 性能开销
				- 序列化后的长度
				- 易用性
			- 协议
				- 用于通信的数据报文的自定义协议
				- 远程过程调用本身的协议
					- 扩展性
						- 可扩展属性及发起方支持能力
						- 版本号
					- 向后兼容性
			- 网络实现选择
				- BIO
				- NIO
				- AIO	
					- Oneway
					- Callback
					- Future
					- 可靠异步
						- 消息中间件
			- 使用Future方式对远程服务调用的优化
		- 服务提供端的设计与实现
			- 如何暴露远程服务
				- 本地服务的注册管理
				- 根据请求定位服务并执行
			- 服务端对请求处理的流程
				- 请求-->网络传输-->反序列化/协议解析-->定位服务-->执行方法/生成方法-->协议适配/序列化-->响应
			- 执行不同服务的线程池隔离
			- 服务提供端的流控处理
		- 服务升级
			- 接口中增加方法
			- 对接口的某些发那个方法修改调用的参数列表
				- 通过版本号解决
					- 老的用老的，新的用新的
				- 设计方法时考虑扩展性
		- 实战中的优化
			- 服务的拆分
			- 服务的粒度
			- 优雅和实用的平衡
				- 服务调用者包含服务提供者读取缓存的所有接口逻辑
			- 分布式环境中的请求合并
				- 分布式锁服务
				- 路由方式选择特定机器
		- 服务治理
			- 管理服务
				- 控制、操作整个分布式系统的服务
			- 查看服务
				- 查询运行时的状态或一些具体信息、历史数据等
				- 服务信息
				- 服务质量
				- 服务容量
				- 服务依赖
				- 服务分布
				- 服务统计
				- 服务元数据
				- 服务查询
				- 服务报表
				- 服务监视
				- 服务上下线
				- 服务路由
				- 服务限流降级
				- 服务归组
				- 服务线程池管理
				- 机房规则
				- 服务授权
		- 服务框架与ESB（Enterprise Service Bus）的对比
			- 服务框架是点对点的模型，ESB是一个总线式的模型
			- 服务框架基本上是面向同构的系统，ESB更多考虑不同厂商提供服务的整合
## 总结 ##
服务框架使应用从集中式走向分布式，解决了当网站功能越来越丰富时，单个应用越来越庞大的问题，使整个系统走向服务化的架构。
- web应用--->数据
- 转换为
- web应用-->服务框架-->服务-->数据
- 再转换为
- web应用-->服务框架-->服务-->数据访问层-->数据